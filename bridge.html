<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bridge/Cockpit Challenge</title>
<style>
  body {
    background: #000;
    margin: 0;
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    color: #0f0;
    user-select: none;
    touch-action: manipulation;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #111;
  }
  .control-btn {
    position: absolute;
    bottom: 20px;
    padding: 15px 25px;
    font-size: 1.5rem;
    border: 2px solid #0f0;
    border-radius: 10px;
    background: #000;
    color: #0f0;
    cursor: pointer;
    user-select: none;
  }
  #boostBtn { left: 50%; transform: translateX(-50%); }
  #leftBtn { left: 20px; }
  #rightBtn { right: 20px; }
  #status {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 1.5rem;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<button id="boostBtn" class="control-btn">BOOST</button>
<button id="leftBtn" class="control-btn">LEFT</button>
<button id="rightBtn" class="control-btn">RIGHT</button>
<div id="status"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const boostBtn = document.getElementById('boostBtn');
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const statusDiv = document.getElementById('status');

let ship = { x: 100, y: 500, width: 40, height: 20, speedX: 0, speedY: 0 };
let asteroids = [];
let completed = false;
let lastTime = 0;
let boostActive = false;
let leftActive = false;
let rightActive = false;

// Generate asteroids
function generateAsteroids(count=30) {
  asteroids = [];
  for(let i=0;i<count;i++){
    asteroids.push({
      x: Math.random() * (canvas.width-40),
      y: Math.random()*-600, // start above canvas
      radius: Math.random()*20 + 15,
      speed: Math.random()*2 + 1
    });
  }
}

// Draw ship
function drawShip() {
  ctx.fillStyle = '#0f0';
  ctx.fillRect(ship.x, ship.y, ship.width, ship.height);
}

// Draw asteroids
function drawAsteroids() {
  ctx.fillStyle = '#f00';
  asteroids.forEach(a=>{
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.radius, 0, 2*Math.PI);
    ctx.fill();
  });
}

// Update positions
function update(delta){
  // Ship movement
  if(leftActive) ship.x -= 4 * delta;
  if(rightActive) ship.x += 4 * delta;
  if(boostActive) ship.y -= 6 * delta; else ship.y += 2 * delta; // gravity down

  // Keep inside canvas
  ship.x = Math.max(0, Math.min(canvas.width - ship.width, ship.x));
  ship.y = Math.max(0, Math.min(canvas.height - ship.height, ship.y));

  // Asteroids fall
  asteroids.forEach(a=>{
    a.y += a.speed * delta;
    if(a.y - a.radius > canvas.height){
      a.y = -a.radius;
      a.x = Math.random()*(canvas.width-40);
      a.speed = Math.random()*2 + 1;
    }
  });
}

// Collision detection
function checkCollision(){
  for(let a of asteroids){
    const dx = ship.x + ship.width/2 - a.x;
    const dy = ship.y + ship.height/2 - a.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < a.radius + Math.max(ship.width, ship.height)/2){
      return true;
    }
  }
  return false;
}

// Game loop
function gameLoop(timestamp){
  const delta = (timestamp - lastTime)/16;
  lastTime = timestamp;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  update(delta);
  drawShip();
  drawAsteroids();

  if(checkCollision() && !completed){
    ship.x = 100;
    ship.y = 500;
    statusDiv.textContent = 'ðŸ’¥ Collision! Ship reset.';
    setTimeout(()=>statusDiv.textContent='', 1500);
  }

  if(ship.y <= 0 && !completed){
    completed = true;
    statusDiv.textContent = 'ðŸš€ Bridge Challenge Complete!';
    boostBtn.disabled = true;
    leftBtn.disabled = true;
    rightBtn.disabled = true;
    updateSheet();
  }

  requestAnimationFrame(gameLoop);
}

// Controls
boostBtn.addEventListener('touchstart', ()=>boostActive=true);
boostBtn.addEventListener('touchend', ()=>boostActive=false);
boostBtn.addEventListener('mousedown', ()=>boostActive=true);
boostBtn.addEventListener('mouseup', ()=>boostActive=false);

leftBtn.addEventListener('touchstart', ()=>leftActive=true);
leftBtn.addEventListener('touchend', ()=>leftActive=false);
leftBtn.addEventListener('mousedown', ()=>leftActive=true);
leftBtn.addEventListener('mouseup', ()=>leftActive=false);

rightBtn.addEventListener('touchstart', ()=>rightActive=true);
rightBtn.addEventListener('touchend', ()=>rightActive=false);
rightBtn.addEventListener('mousedown', ()=>rightActive=true);
rightBtn.addEventListener('mouseup', ()=>rightActive=false);

// Google Sheet update
async function updateSheet(){
  try{
    await fetch(`${API_URL}?index=8&status=ON`, {method:'POST'});
  }catch(e){
    console.error('Failed to update sheet:', e);
  }
}

// Initialize
generateAsteroids();
requestAnimationFrame(gameLoop);

</script>
</body>
</html>
