<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bridge/Cockpit Challenge</title>
<style>
  body {
    background: #000;
    margin: 0;
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    color: #0f0;
    user-select: none;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #111;
  }
  #boostBtn {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 30px;
    font-size: 1.5rem;
    border: 2px solid #0f0;
    border-radius: 10px;
    background: #000;
    color: #0f0;
    cursor: pointer;
  }
  #status {
    position: absolute;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 1.5rem;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<button id="boostBtn">BOOST</button>
<div id="status"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const boostBtn = document.getElementById('boostBtn');
const statusDiv = document.getElementById('status');

let ship = { x: 100, y: 300, width: 40, height: 20, speed: 0 };
let asteroids = [];
let completed = false;
let lastTime = 0;

// Generate asteroids
function generateAsteroids() {
  asteroids = [];
  for(let i=0; i<15; i++){
    asteroids.push({
      x: 200 + i*150,
      y: Math.random()*500 + 50,
      radius: Math.random()*30 + 20
    });
  }
}

// Draw ship
function drawShip() {
  ctx.fillStyle = '#0f0';
  ctx.fillRect(ship.x, ship.y, ship.width, ship.height);
}

// Draw asteroids
function drawAsteroids() {
  ctx.fillStyle = '#f00';
  asteroids.forEach(a=>{
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.radius, 0, 2*Math.PI);
    ctx.fill();
  });
}

// Move ship
function updateShip(delta) {
  ship.x += ship.speed * delta;
  if(ship.x + ship.width > canvas.width) ship.x = canvas.width - ship.width;
}

// Check collisions
function checkCollision() {
  for(let a of asteroids){
    const dx = ship.x + ship.width/2 - a.x;
    const dy = ship.y + ship.height/2 - a.y;
    const distance = Math.sqrt(dx*dx + dy*dy);
    if(distance < a.radius + Math.max(ship.width, ship.height)/2){
      return true;
    }
  }
  return false;
}

// Game loop
function gameLoop(timestamp){
  const delta = (timestamp - lastTime)/16;
  lastTime = timestamp;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  updateShip(delta);
  drawShip();
  drawAsteroids();

  if(checkCollision()){
    ship.x -= 5; // push back a little
    statusDiv.textContent = 'ðŸ’¥ Collision! Wait 2 seconds...';
    boostBtn.disabled = true;
    setTimeout(()=>{ boostBtn.disabled=false; statusDiv.textContent=''; },2000);
  }

  // Check completion
  if(ship.x + ship.width >= canvas.width && !completed){
    completed = true;
    statusDiv.textContent = 'ðŸš€ Bridge Challenge Complete!';
    boostBtn.disabled = true;
    updateSheet();
  }

  requestAnimationFrame(gameLoop);
}

// Boost button
boostBtn.onclick = () => {
  ship.speed = 6;
  setTimeout(()=>{ ship.speed=0; }, 200); // short burst
}

// Initialize
generateAsteroids();
requestAnimationFrame(gameLoop);

// Google Sheet update
async function updateSheet(){
  try{
    await fetch(`${API_URL}?index=8&status=ON`, {method:'POST'}); // index 8 = bridge
  }catch(e){
    console.error('Failed to update sheet:', e);
  }
}
</script>
</body>
</html>
