<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deflector Shield Riddle</title>
<style>
  body {
    background: #000;
    color: #0f0;
    font-family: 'Share Tech Mono', monospace;
    padding: 40px;
  }
  #terminal {
    max-width: 700px;
    margin: 0 auto;
    border: 1px solid #0f0;
    border-radius: 8px;
    padding: 24px;
    background: #010;
    box-shadow: 0 0 20px rgba(0,255,0,0.08);
  }
  .line { white-space: pre-wrap; margin: 8px 0; }
  .muted { color: #66ff66a0; }
  .error { color: #ff6666; }
  .success { color: #66ff66; font-weight: bold; }
  #shieldPanel {
    display: grid;
    grid-template-columns: repeat(3, 60px);
    grid-gap: 10px;
    margin-top: 20px;
    justify-content: center;
  }
  .shieldNode {
    width: 60px;
    height: 60px;
    border: 2px solid #0f0;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s;
  }
  .active {
    background: #0f0;
    color: #000;
    font-weight: bold;
  }
  .disabled {
    opacity: 0.45;
    pointer-events: none;
  }
</style>
</head>
<body>
<div id="terminal">
  <div class="line">> DEFLECTOR SHIELDS CRITICAL ALERT</div>
  <div class="line muted">> ACTIVATE SHIELDS IN THE CORRECT SEQUENCE</div>
  <div id="shieldPanel">
    <div class="shieldNode" id="S1">S1</div>
    <div class="shieldNode" id="S2">S2</div>
    <div class="shieldNode" id="S3">S3</div>
    <div class="shieldNode" id="S4">S4</div>
    <div class="shieldNode" id="S5">S5</div>
    <div class="shieldNode" id="S6">S6</div>
    <div class="shieldNode" id="S7">S7</div>
    <div class="shieldNode" id="S8">S8</div>
    <div class="shieldNode" id="S9">S9</div>
  </div>
  <div id="feedback" class="line"></div>
  <div id="lockedArea" class="line success" style="display:none;">
    > SHIELDS ONLINE — ALL LASERS BLOCKED  
    > SYSTEM STABLE
  </div>
</div>

<script>
(function(){
  const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
  const SHEET_INDEX = 4;

  const correctSequence = ['S3','S1','S6','S2','S5'];
  let userSequence = [];

  const feedback = document.getElementById('feedback');
  const lockedArea = document.getElementById('lockedArea');
  const nodes = Array.from(document.getElementsByClassName('shieldNode'));

  function resetNodes() {
    nodes.forEach(n => n.classList.remove('active'));
    userSequence = [];
  }

  function lockSuccess() {
    nodes.forEach(n => n.classList.add('disabled'));
    lockedArea.style.display='block';
  }

  async function postStatus(state) {
    try {
      await fetch(`${API_URL}?index=${SHEET_INDEX}&status=${state}`, {method:'POST'});
    } catch(e){console.error(e);}
  }

  function checkStatus() {
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        if(data[SHEET_INDEX]==='ON') {
          lockSuccess();
        }
      }).catch(e=>{});
  }

  function handleClick(nodeId, nodeElem) {
    if(nodeElem.classList.contains('active')) return;
    nodeElem.classList.add('active');
    userSequence.push(nodeId);

    for(let i=0;i<userSequence.length;i++){
      if(userSequence[i] !== correctSequence[i]){
        feedback.textContent = '> SHIELDS INSUFFICIENT — TRY AGAIN!';
        feedback.className = 'line error';
        setTimeout(resetNodes, 700);
        return;
      }
    }

    if(userSequence.length === correctSequence.length){
      feedback.textContent = '> SHIELDS ONLINE — ALL LASERS BLOCKED';
      feedback.className='line success';
      postStatus('ON');
      setTimeout(lockSuccess,500);
    }
  }

  nodes.forEach(n=>{
    n.addEventListener('click', ()=>handleClick(n.id,n));
  });

  checkStatus();
})();
</script>
</body>
</html>
