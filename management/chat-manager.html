<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spaceship Chat - Manager</title>
<style>
body {
  background:#0b0c0f;
  color:#00ff99;
  font-family:monospace;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
h1 { text-shadow:0 0 15px #00ff99; margin-bottom:20px; }
#chatBox {
  width:400px;
  height:500px;
  border:2px solid #00ff99;
  overflow-y:auto;
  padding:10px;
  background:#11181f;
  border-radius:10px;
}
.message { margin:8px 0; padding:8px 12px; border-radius:15px; max-width:70%; box-shadow:0 0 8px #00ff99; }
.player { background:#007f44; color:#0f0; margin-left:auto; text-align:right; }
.manager { background:#3333aa; color:#66f; margin-right:auto; text-align:left; }
.timestamp { display:block; font-size:0.6rem; color:#aaa; margin-top:4px; }
#messageInput { width:300px; padding:5px; border-radius:5px; border:none; background:#222; color:#0f0; }
#sendBtn { padding:5px 10px; margin-left:5px; background:#00ff99; color:#0b0c0f; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<h1>Spaceship Chat - Manager</h1>
<div id="chatBox"></div>
<div style="display:flex;margin-top:10px;">
  <input type="text" id="messageInput" placeholder="Type a message">
  <button id="sendBtn">Send</button>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyfVOmU5cjEOAjFAR-gy-yVYbtI56Ub_U-Id6CsP-2MfVetfl9n0d0m97pk6-7-To_S/exec';
const chatBox = document.getElementById('chatBox');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

async function loadMessages() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    chatBox.innerHTML = '';
    data.forEach(msg => {
      const div = document.createElement('div');
      div.className = 'message ' + (msg.Sender==='Kai'?'player':'manager');
      div.innerHTML = `<strong>${msg.Sender}:</strong> ${msg.Message}<span class="timestamp">${new Date(msg.Timestamp).toLocaleString()}</span>`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch(e) { console.error('Load messages error', e); }
}

async function sendMessage() {
  const msg = messageInput.value.trim();
  if(!msg) return;
  try {
    const res = await fetch(API_URL, {
      method:'POST',
      body: JSON.stringify({Sender:'Manager', Message:msg})
    });
    if(!res.ok) throw new Error('Network response not ok');
    messageInput.value = '';
    loadMessages();
  } catch(e) { console.error('Send message error', e); alert('Failed to send message'); }
}

sendBtn.addEventListener('click', sendMessage);
messageInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

setInterval(loadMessages,2000);
loadMessages();
</script>
</body>
</html>
