<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Power Reactor Challenge</title>
  <style>
    body {
      background: #0b0c0f;
      color: #00ff99;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 { 
      font-size: 2rem;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #00ff99, 0 0 20px #00ff99;
    }
    table {
      margin: 0 auto 20px auto;
      border-collapse: collapse;
      width: 400px;
    }
    th, td {
      border: 1px solid #00ff99;
      padding: 10px;
      font-size: 1.2rem;
    }
    th {
      background: #11181f;
    }
    td {
      background: #11181f;
    }
    .module-btn {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1.2rem;
      border: 2px solid #00ff99;
      border-radius: 8px;
      background: #11181f;
      color: #00ff99;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s ease;
    }
    .module-btn.selected {
      background: #0f0;
      color: #000;
    }
    #submitBtn, #retryBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1.2rem;
      border: 2px solid #00ff99;
      border-radius: 10px;
      background: #11181f;
      color: #00ff99;
      cursor: pointer;
    }
    #submitBtn:hover, #retryBtn:hover {
      background: #0f0;
      color: #000;
    }
    #status {
      margin-top: 20px;
      font-size: 1.4rem;
    }
  </style>
</head>
<body>
  <h1>Power Reactor Challenge</h1>
  <table>
    <tr><th>Module</th><th>Energy</th></tr>
    <tr><td>A</td><td>3</td></tr>
    <tr><td>B</td><td>5</td></tr>
    <tr><td>C</td><td>2</td></tr>
    <tr><td>D</td><td>7</td></tr>
    <tr><td>E</td><td>4</td></tr>
    <tr><td>F</td><td>6</td></tr>
    <tr><td>G</td><td>1</td></tr>
    <tr><td>H</td><td>8</td></tr>
    <tr><td>I</td><td>9</td></tr>
  </table>

  <div id="buttonsContainer"></div>
  <button id="submitBtn">Submit Selection</button>
  <button id="retryBtn" style="display:none;">Retry</button>
  <div id="status"></div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
    const moduleLetters = ['A','B','C','D','E','F','G','H','I'];
    const buttonsContainer = document.getElementById('buttonsContainer');
    const submitBtn = document.getElementById('submitBtn');
    const retryBtn = document.getElementById('retryBtn');
    const statusDiv = document.getElementById('status');

    // all 8 valid 3-module combos
    const validCombos = [
      ['A','B','F'],
      ['A','C','I'],
      ['A','D','E'],
      ['B','C','D'],
      ['B','G','H'],
      ['C','E','H'],
      ['D','F','G'],
      ['E','G','I']
    ];

    let selected = [];
    let locked = false;

    // create module buttons
    moduleLetters.forEach(letter => {
      const btn = document.createElement('button');
      btn.textContent = letter;
      btn.className = 'module-btn';
      btn.onclick = () => {
        if(locked) return;
        if(selected.includes(letter)) {
          selected = selected.filter(x => x !== letter);
          btn.classList.remove('selected');
        } else if(selected.length < 3) {
          selected.push(letter);
          btn.classList.add('selected');
        }
      };
      buttonsContainer.appendChild(btn);
    });

    function arraysEqual(a,b){
      return a.length===b.length && a.every(v=>b.includes(v));
    }

    function checkSelection(){
      const sortedSelected = [...selected].sort();
      const isValid = validCombos.some(combo => arraysEqual(combo, sortedSelected));
      if(isValid){
        statusDiv.textContent = '✅ Correct! Reactor Modules Activated!';
        statusDiv.style.color = '#0f0';
        lockAll();
        updateSheet();
      } else {
        statusDiv.textContent = '❌ Incorrect! 5 second penalty...';
        statusDiv.style.color = '#f00';
        lockAll();
        retryBtn.style.display = 'inline-block';
        setTimeout(()=>unlockAll(), 5000);
      }
    }

    function lockAll(){
      locked = true;
      document.querySelectorAll('.module-btn').forEach(b=>b.disabled=true);
      submitBtn.disabled = true;
    }

    function unlockAll(){
      locked = false;
      document.querySelectorAll('.module-btn').forEach(b=>b.disabled=false);
      submitBtn.disabled = false;
      selected = [];
      document.querySelectorAll('.module-btn').forEach(b=>b.classList.remove('selected'));
      retryBtn.style.display='none';
      statusDiv.textContent='';
    }

    submitBtn.onclick = checkSelection;
    retryBtn.onclick = unlockAll;

    async function updateSheet(){
      try{
        await fetch(`${API_URL}?index=3&status=ON`, {method:'POST'}); // index 3 for power reactor
      }catch(e){
        console.error('Failed to update sheet:', e);
      }
    }
  </script>
</body>
</html>
