<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <title>Spaceship Dashboard - Client</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    body {
      background: #0b0c0f;
      color: #00ff99;
      font-family: 'Orbitron', sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
    }

    h1 {
      margin-bottom: 40px;
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-shadow:
        0 0 10px #00ff99,
        0 0 20px #00ff99;
    }

    .dashboard {
      position: relative;
      width: 650px;
      height: 650px;
    }

    .button-container {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: default;
      user-select: none;
      transition: transform 0.3s ease;
    }

    .button-container:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 0 12px #00ff99);
      z-index: 10;
    }

    .button {
      width: 120px;
      height: 120px;
      background: #11181f;
      border-radius: 25px;
      border: 3px solid #00ff99;
      box-shadow:
        inset 0 0 20px #007f44,
        0 0 20px #00ff99;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 900;
      font-size: 1.8rem;
      color: #00ff99;
      letter-spacing: 0.1em;
      text-shadow:
        0 0 12px #00ff99;
      position: relative;
      user-select: none;
      transition: box-shadow 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    .button.off {
      border-color: #ff3b3b;
      box-shadow:
        inset 0 0 20px #7f0000,
        0 0 20px #ff3b3b;
      color: #ff3b3b;
      text-shadow: 0 0 12px #ff3b3b;
    }

    /* Main (Status) button center */
    .main-button-container {
      position: absolute;
      width: 260px;
      height: 260px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      user-select: none;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .main-button {
      width: 220px;
      height: 220px;
      background: #11181f;
      border-radius: 40px;
      border: 10px solid transparent; /* thick border for glow ring */
      position: relative;
      font-weight: 900;
      letter-spacing: 0.1em;
      font-size: 2.6rem;
      color: #00ff99;
      text-align: center;
      line-height: 220px;
      text-shadow: 0 0 12px #00ff99;
      transition: color 0.3s ease;
      box-shadow:
        inset 0 0 30px #007f44,
        0 0 30px #00ff99;
      z-index: 2;
    }

    .main-button.off {
      color: #ff3b3b;
      text-shadow: 0 0 12px #ff3b3b;
      box-shadow:
        inset 0 0 30px #7f0000,
        0 0 30px #ff3b3b;
    }

    /* Circular segmented glowing border ring using conic-gradient */

    .main-button-container::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      width: 240px;
      height: 240px;
      border-radius: 50%;
      z-index: 1;
      pointer-events: none;
      user-select: none;

      /* The conic-gradient simulates 11 segments:
         green segments are ON, red segments are OFF */

      background:
        conic-gradient(
          #0f0 0deg 32.7deg,  /* 360/11 = ~32.7deg */
          #700 32.7deg 65.4deg,
          #0f0 65.4deg 98.1deg,
          #700 98.1deg 130.8deg,
          #0f0 130.8deg 163.5deg,
          #700 163.5deg 196.2deg,
          #0f0 196.2deg 228.9deg,
          #700 228.9deg 261.6deg,
          #0f0 261.6deg 294.3deg,
          #700 294.3deg 327deg,
          #0f0 327deg 360deg
        );
      box-shadow:
        0 0 40px #00ff00;
      filter: drop-shadow(0 0 20px #00ff00);
    }

    /* Light indicator */
    .light {
      position: absolute;
      bottom: 14px;
      right: 14px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #700000;
      box-shadow: 0 0 8px #300;
      transition: background 0.3s, box-shadow 0.3s, border-color 0.3s;
      border: 2px solid #330000;
      user-select: none;
      pointer-events: none;
    }

    .light.on {
      background: #0f0;
      box-shadow: 0 0 18px #0f0;
      border-color: #0a0;
    }

  </style>
</head>
<body>
  <h1>Spaceship Dashboard - Client View</h1>
  <div class="dashboard" id="dashboard">
    <!-- Buttons will be created by JS -->
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
    const dashboard = document.getElementById('dashboard');

    // Status page URL (change this to your actual GitHub Pages status page)
    const STATUS_PAGE_URL = 'https://yourgithubusername.github.io/mission-status.html';

    function createButtons() {
      const containers = [];

      // Create buttons 1 to 11 in circle
      for (let i = 0; i < 11; i++) {
        const container = document.createElement('div');
        container.className = 'button-container';

        const button = document.createElement('div');
        button.className = 'button';
        button.textContent = `Btn ${i + 1}`;

        const light = document.createElement('div');
        light.className = 'light';
        light.id = `light-${i}`;

        container.appendChild(button);
        container.appendChild(light);
        dashboard.appendChild(container);

        containers.push(container);
      }

      // Create main status button (button 12)
      const mainContainer = document.createElement('div');
      mainContainer.className = 'main-button-container';

      const mainButton = document.createElement('div');
      mainButton.className = 'button main-button';
      mainButton.textContent = 'STATUS';

      mainContainer.appendChild(mainButton);

      dashboard.appendChild(mainContainer);

      // Add click event to main button
      mainButton.addEventListener('click', () => {
        window.location.href = STATUS_PAGE_URL;
      });

      containers.push(mainContainer);

      return containers;
    }

    // Positions 11 buttons evenly around center button
    function positionButtons(buttonContainers, centerX, centerY, radius) {
      // First 11 buttons (0-10) around circle
      for (let i = 0; i < 11; i++) {
        const container = buttonContainers[i];
        // Calculate angle for even spacing
        const angle = (i / 11) * (2 * Math.PI) - Math.PI / 2; // start from top

        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        container.style.left = `${x}px`;
        container.style.top = `${y}px`;
        container.style.transform = 'translate(-50%, -50%)';
      }

      // Main button (index 11) center (already positioned absolute with CSS)
      const mainContainer = buttonContainers[11];
      // Positions handled by CSS (.main-button-container), so no changes here
    }

    // Update button lights and progress ring based on API data
    async function updateButtons() {
      try {
        const res = await fetch(API_URL);
        const statuses = await res.json();

        // Update buttons 1 to 11
        for(let i = 0; i < 11; i++) {
          const container = dashboard.children[i];
          const button = container.querySelector('.button');
          const light = container.querySelector('.light');

          if (statuses[i] === 'ON') {
            button.classList.remove('off');
            light.classList.add('on');
          } else {
            button.classList.add('off');
            light.classList.remove('on');
          }
        }

        // Update main button ring segments dynamically by updating the conic-gradient

        const mainButtonContainer = dashboard.querySelector('.main-button-container');

        // Build gradient string based on status array: green segment if ON else dark red
        let gradientParts = [];
        const segmentAngle = 360 / 11;

        for (let i = 0; i < 11; i++) {
          const startAngle = (i * segmentAngle);
          const endAngle = startAngle + segmentAngle * 0.9; // slight gap for separation
          const color = statuses[i] === 'ON' ? '#0f0' : '#700000';

          gradientParts.push(`${color} ${startAngle}deg ${endAngle}deg`);
          // Gap part is transparent, so next start angle is endAngle to next segment start
          if(i < 10) {
            gradientParts.push(`#11181f ${endAngle}deg ${(startAngle + segmentAngle)}deg`);
          }
        }

        const gradientStr = `conic-gradient(${gradientParts.join(',')})`;

        mainButtonContainer.style.setProperty('--progress-gradient', gradientStr);

        // Update main button glow color based on overall status
        const allOn = statuses.every(s => s === 'ON');
        const mainButton = mainButtonContainer.querySelector('.main-button');
        if (allOn) {
          mainButton.classList.remove('off');
        } else {
          mainButton.classList.add('off');
        }

      } catch (e) {
        console.error('Failed to update button status:', e);
      }
    }

    // Initialize
    const buttons = createButtons();

    const centerX = 325; // half of dashboard width 650px
    const centerY = 325; // half of dashboard height
    const radius = 250;

    positionButtons(buttons, centerX, centerY, radius);

    updateButtons();
    setInterval(updateButtons, 3000);

    // Reposition on resize (optional)
    window.addEventListener('resize', () => {
      positionButtons(buttons, centerX, centerY, radius);
    });
  </script>
  <style>
    /* This style applies the dynamic conic-gradient ring to main button container */

    .main-button-container {
      --progress-gradient: conic-gradient(#700000 0deg 360deg);
      box-shadow:
        0 0 40px #00ff00;
      filter: drop-shadow(0 0 20px #00ff00);
    }

    .main-button-container::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      width: 240px;
      height: 240px;
      border-radius: 50%;
      z-index: 1;
      pointer-events: none;
      user-select: none;
      background: var(--progress-gradient);
      transition: background 0.5s ease;
    }
  </style>
</body>
</html>
