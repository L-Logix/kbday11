<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Life Support Challenge</title>
<style>
  body {
    background: #0b0c0f;
    color: #00ff99;
    font-family: 'Orbitron', monospace;
    text-align: center;
    padding: 20px;
  }
  h1 { margin-bottom: 30px; text-shadow: 0 0 10px #00ff99; }
  .slider-container { margin: 20px 0; }
  input[type=range] {
    width: 60%;
  }
  .status {
    margin-top: 20px;
    font-weight: bold;
    font-size: 1.2rem;
  }
  button {
    background: #11181f;
    border: 3px solid #00ff99;
    color: #00ff99;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 15px;
  }
  button:disabled {
    border-color: #555;
    color: #555;
    cursor: default;
  }
  .light {
    display:inline-block;
    width:20px; height:20px;
    border-radius:50%;
    margin-left:10px;
    vertical-align:middle;
    border:2px solid #330000;
    background:#700000;
  }
  .light.on { background:#0f0; border-color:#0a0; box-shadow:0 0 8px #0f0; }
</style>
</head>
<body>
<h1>Life Support Challenge</h1>

<div class="slider-container">
  Oxygen Level: <span id="oxygenValue">50</span>
  <input type="range" id="oxygen" min="0" max="100" value="50">
  <span class="light" id="oxygenLight"></span>
</div>

<div class="slider-container">
  Cabin Temperature: <span id="temperatureValue">50</span>
  <input type="range" id="temperature" min="0" max="100" value="50">
  <span class="light" id="temperatureLight"></span>
</div>

<div class="slider-container">
  Pressure: <span id="pressureValue">50</span>
  <input type="range" id="pressure" min="0" max="100" value="50">
  <span class="light" id="pressureLight"></span>
</div>

<button id="submitBtn">Stabilize Life Support</button>
<div class="status" id="status">Adjust sliders to stabilize the life support system.</div>
<button id="retryBtn" style="display:none;">Retry</button>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwCJEfr5PJguOJ79eDjA3QSiK-qe01gMIqCTTKLtjOst4bsavkNMQSx01QThXejm3UU/exec';
const challengeIndex = 10; // Life Support index

const correctValues = {
  oxygen: 70,
  temperature: 65,
  pressure: 80
};

const tolerance = 5; // +/- tolerance for “correct”

const oxygen = document.getElementById('oxygen');
const temperature = document.getElementById('temperature');
const pressure = document.getElementById('pressure');

const oxygenValue = document.getElementById('oxygenValue');
const temperatureValue = document.getElementById('temperatureValue');
const pressureValue = document.getElementById('pressureValue');

const oxygenLight = document.getElementById('oxygenLight');
const temperatureLight = document.getElementById('temperatureLight');
const pressureLight = document.getElementById('pressureLight');

const status = document.getElementById('status');
const submitBtn = document.getElementById('submitBtn');
const retryBtn = document.getElementById('retryBtn');

function updateDisplays() {
  oxygenValue.textContent = oxygen.value;
  temperatureValue.textContent = temperature.value;
  pressureValue.textContent = pressure.value;
}

// Update lights in real-time
function updateLights() {
  oxygenLight.classList.toggle('on', Math.abs(oxygen.value - correctValues.oxygen) <= tolerance);
  temperatureLight.classList.toggle('on', Math.abs(temperature.value - correctValues.temperature) <= tolerance);
  pressureLight.classList.toggle('on', Math.abs(pressure.value - correctValues.pressure) <= tolerance);
}

[oxygen, temperature, pressure].forEach(slider => {
  slider.addEventListener('input', ()=>{
    updateDisplays();
    updateLights();
  });
});

function disableSliders() {
  oxygen.disabled = true;
  temperature.disabled = true;
  pressure.disabled = true;
  submitBtn.disabled = true;
}

function enableSliders() {
  oxygen.disabled = false;
  temperature.disabled = false;
  pressure.disabled = false;
  submitBtn.disabled = false;
}

// Check completion
async function checkCompleted() {
  try {
    const res = await fetch(API_URL);
    const statuses = await res.json();
    if(statuses[challengeIndex]==='ON'){
      status.textContent = 'Life Support Already Stabilized ✅';
      disableSliders();
    }
  } catch(e){ console.error(e); }
}
checkCompleted();

submitBtn.addEventListener('click', ()=>{
  const oxyCorrect = Math.abs(oxygen.value - correctValues.oxygen)<=tolerance;
  const tempCorrect = Math.abs(temperature.value - correctValues.temperature)<=tolerance;
  const presCorrect = Math.abs(pressure.value - correctValues.pressure)<=tolerance;

  if(oxyCorrect && tempCorrect && presCorrect){
    status.textContent = 'Life Support Stabilized! ✅';
    disableSliders();
    retryBtn.style.display='none';
    // Update Google Sheet
    fetch(`${API_URL}?index=${challengeIndex}&status=ON`, {method:'POST'});
  } else {
    status.textContent = 'Incorrect settings! Retry in 5 seconds...';
    disableSliders();
    retryBtn.style.display='none';
    setTimeout(()=>{
      status.textContent='Adjust sliders to stabilize the life support system.';
      enableSliders();
      retryBtn.style.display='inline-block';
    },5000);
  }
});

retryBtn.addEventListener('click', ()=>{
  status.textContent='Adjust sliders to stabilize the life support system.';
  enableSliders();
  retryBtn.style.display='none';
});

updateDisplays();
updateLights();
</script>
</body>
</html>
